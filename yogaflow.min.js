function allow_drop(e){e.preventDefault()}function get_dropped_asana(e){return document.getElementById(e.dataTransfer.getData("asana_id"))}function set_dropped_asana(e,t){e.dataTransfer.setData("asana_id",e.target.id)}function show_edit(){document.getElementById("trash").className="";document.getElementById("flow-window").className="";document.getElementById("asanas").className="";document.getElementById("edit-button").style.display="none";document.getElementById("stop-editing").className=""}function hide_edit(){document.getElementById("trash").className="hidden";document.getElementById("asanas").className="hidden";document.getElementById("edit-button").style.display="block";document.getElementById("stop-editing").className="hidden"}function hide_instructions(){var e=document.querySelectorAll(".instructions");for(i=0,len=e.length;i<len;i++){e[i].style.display="none"}document.getElementById("flow").className=""}var Asana={create:function(e){asana=document.createElement("li");asana.innerHTML=e;asana.title=e;asana.draggable=true;return asana},hover_begin:function(e){e.target.style.opacity=.5},hover_end:function(e){e.target.style.opacity=1},reorder_drop:function(e){e.stopPropagation();e.target.parentNode.insertBefore(Asana.prepare_for_flow(get_dropped_asana(e)),e.target);e.target.style.opacity=1;Hash.rebuild()},flow_drop:function(e){return function(t){var n=get_dropped_asana(t);e.appendChild(Asana.prepare_for_flow(n));hide_instructions();Hash.rebuild()}},trash_drop:function(e){return function(t){e.removeChild(get_dropped_asana(t));Hash.rebuild()}},drag_start:function(e){set_dropped_asana(e);e.target.style.opacity=.5},drag_end:function(e){e.target.style.opacity=1},prepare_for_flow:function(e){if(e.parentNode!=null&&e.parentNode.id!="flow"){e=e.cloneNode(true);e.id="asana"+Date.now()}e.ondragstart=Asana.drag_start;e.ondragend=Asana.drag_end;e.ondragenter=Asana.hover_begin;e.ondragleave=Asana.hover_end;e.ondrop=Asana.reorder_drop;e.ondragover=allow_drop;return e}};var Hash={rebuild:function(){var e="";var t=document.getElementById("flow").children;for(i=0,len=t.length;i<len;i++){e+=Hash.encode_index(t[i].getAttribute("data-asana"))}window.location.hash=$.base64.encode(e)},encode_index:function(e){return String.fromCharCode(parseInt(e))},decode_index:function(e){return e.charCodeAt(0)}};var Setup={asanas:function(e,t){for(i=0,len=e.length;i<len;i++){asana=Asana.create(e[i]);asana.ondrag=Asana.drag_end;asana.ondragstart=Asana.drag_start;asana.ondragend=Asana.drag_end;asana.id="asana"+i;asana.setAttribute("data-asana",i);t.appendChild(asana)}},flow:function(e,t,n){var r;var s;var t=$.base64.decode(t.slice(1));for(i=0,len=t.length;i<len;i++){s=Hash.decode_index(t[i]);r=Asana.create(n[s]);r.id="flow-asana"+i;r.setAttribute("data-asana",s);e.appendChild(Asana.prepare_for_flow(r))}}};window.onload=function(){var e=window.location.hash;var t=document.getElementById("trash");var n=document.getElementById("flow-window");var r=document.getElementById("flow");var s=document.getElementById("asanas");var o=document.getElementById("edit-button");var u=["Cobra","Warrior I","Savasana","Warrior 2","Eagle","Child","Plow","Plank","Happy Baby","Shoulder Stand","Lotus","Dancer","Pigeon","King Pigeon","Goddess"];u.sort();if(s.innerHTML==""){Setup.asanas(u,s)}else{for(i=0,len=s.children.length;i<len;i++){asana=s.children[i];asana.ondrag=Asana.drag_end;asana.ondragstart=Asana.drag_start;asana.ondragend=Asana.drag_end}}if(e.length>0){Setup.flow(r,e,u);o.style.display="block";hide_instructions();document.getElementById("flow-window").className=""}else{show_edit();s.className=""}o.onclick=show_edit;t.ondragover=allow_drop;t.ondrop=Asana.trash_drop(r);n.ondragover=allow_drop;n.ondrop=Asana.flow_drop(r);document.getElementById("stop-editing").onclick=hide_edit;$("#flow-window").blurjs({source:"#background-loader",radius:20,overlay:"rgba(0,51,51,0.2)"})}
